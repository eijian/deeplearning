--
-- CNN check
--

module Main (
  main
) where

import Control.Monad
import Data.Time
import Debug.Trace

import CNN.Algebra
import CNN.Image
import CNN.Pool
import CNN.LayerType
import CNN.Layer
import CNN.ActLayer
import CNN.PoolLayer
import CNN.ConvLayer
import CNN.FullConnLayer

import Trainer

x :: [Trainer]
x = [([[[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.0,0.5,0.5,0.5],
        [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],
        [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],
        [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.5,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0],
        [0.0,0.5,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,0.0,0.5,0.0]]],
        [1.0,0.0,0.0])]

fc1 :: [FilterC]
fc1 = [([[ 0.085905  , -0.0678689 ,  0.3814169 ],
         [ 0.43463653,  0.04209257,  0.20257941],
         [-0.41531846,  0.31991767,  0.43873657]],0.0),
       ([[-0.15370686,  0.30818845,  0.09809999],
         [-0.05181358,  0.02393685,  0.24620931],
         [-0.21878266, -0.0326504 ,  0.30548354]],0.0),
       ([[ 0.15663988, -0.11626568, -0.31853248],
         [-0.08551628,  0.37949085,  0.15236294],
         [-0.07106829,  0.06041856, -0.40324084]],0.0),
       ([[ 0.43609989,  0.10470975,  0.2458974 ],
         [ 0.3795274 , -0.13935709,  0.27390678],
         [ 0.3279409 ,  0.14605017,  0.07812175]],0.0),
       ([[ 0.34610384, -0.04524003, -0.22491246],
         [ 0.27643535,  0.17346834, -0.0795374 ],
         [-0.43491274,  0.39947938,  0.09260994]],0.0),
       ([[-0.43418139, -0.00132555,  0.08678753],
         [-0.1758468 , -0.03364892, -0.00387168],
         [ 0.07537   ,  0.32523807,  0.29232075]],0.0),
       ([[ 0.2451028 ,  0.04261545,  0.09982441],
         [ 0.20612988,  0.05839701,  0.24215263],
         [ 0.42810306,  0.25446708,  0.10060225]],0.0),
       ([[-0.30066952, -0.02077727, -0.19036335],
         [-0.3046046 ,  0.24392145, -0.3880607 ],
         [-0.37032283,  0.14451058,  0.02054084]],0.0),
       ([[-0.04715565, -0.16996655, -0.42473247],
         [-0.18167216, -0.20431407, -0.40762712],
         [ 0.26751916, -0.14623689,  0.34481431]],0.0),
       ([[ 0.27307444,  0.40835462,  0.40273468],
         [ 0.08021495, -0.16585497,  0.36816116],
         [-0.39537489, -0.24131427, -0.12080253]],0.0)]

layers :: [Layer]
layers = [
    ConvLayer 3 fc1
  ]

main :: IO ()
main = do
    putStrLn ("X=\n" ++ (show x))
    let
      rls = tail $ map reverseLayer $ reverse layers
      im  = fst $ head x
      op  = forwardProp layers [im]
    putStrLn ("OPLEN=\n" ++ (show $ length op))
    putStrLn ("OP=\n" ++ (show $ head op))
