--
-- CNN check
--

module Main (
  main
) where

import Control.Monad
import Data.Time
import Debug.Trace

import CNN.Algebra
import CNN.Image
import CNN.Pool
import CNN.LayerType
import CNN.Layer
import CNN.ActLayer
import CNN.PoolLayer
import CNN.ConvLayer
import CNN.FullConnLayer

import Trainer

x :: [Trainer]
x = [([[[0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.0,0.5,0.5,0.5],
        [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],
        [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],
        [0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.5,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0],
        [0.0,0.5,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],
        [0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,0.0,0.5,0.0]]],
        [1.0,0.0,0.0])]

fc1 :: [FilterC]
fc1 = [([[ 0.085905  , -0.0678689 ,  0.3814169 ,
           0.43463653,  0.04209257,  0.20257941,
          -0.41531846,  0.31991767,  0.43873657]],0.0),
       ([[-0.15370686,  0.30818845,  0.09809999,
          -0.05181358,  0.02393685,  0.24620931,
          -0.21878266, -0.0326504 ,  0.30548354]],0.0),
       ([[ 0.15663988, -0.11626568, -0.31853248,
          -0.08551628,  0.37949085,  0.15236294,
          -0.07106829,  0.06041856, -0.40324084]],0.0),
       ([[ 0.43609989,  0.10470975,  0.2458974 ,
           0.3795274 , -0.13935709,  0.27390678,
           0.3279409 ,  0.14605017,  0.07812175]],0.0),
       ([[ 0.34610384, -0.04524003, -0.22491246,
           0.27643535,  0.17346834, -0.0795374 ,
          -0.43491274,  0.39947938,  0.09260994]],0.0),
       ([[-0.43418139, -0.00132555,  0.08678753,
          -0.1758468 , -0.03364892, -0.00387168,
           0.07537   ,  0.32523807,  0.29232075]],0.0),
       ([[ 0.2451028 ,  0.04261545,  0.09982441,
           0.20612988,  0.05839701,  0.24215263,
           0.42810306,  0.25446708,  0.10060225]],0.0),
       ([[-0.30066952, -0.02077727, -0.19036335,
          -0.3046046 ,  0.24392145, -0.3880607 ,
          -0.37032283,  0.14451058,  0.02054084]],0.0),
       ([[-0.04715565, -0.16996655, -0.42473247,
          -0.18167216, -0.20431407, -0.40762712,
           0.26751916, -0.14623689,  0.34481431]],0.0),
       ([[ 0.27307444,  0.40835462,  0.40273468,
           0.08021495, -0.16585497,  0.36816116,
          -0.39537489, -0.24131427, -0.12080253]],0.0)]

fc2 :: [FilterC]
fc2 = [([[-0.05549437, 0.2812032 , 0.05020593,-0.19811028],
         [ 0.06102226, 0.27433157,-0.23139136, 0.30502289],
         [-0.21890826, 0.20284628, 0.11228393,-0.06065928],
         [-0.17880337, 0.17303018, 0.21990221, 0.01878369],
         [-0.05717416,-0.3046488 ,-0.22220717, 0.19247847],
         [-0.05073677,-0.10168774,-0.12829623, 0.13786645],
         [ 0.31484091, 0.03282588, 0.24659191,-0.20967907],
         [ 0.24258736, 0.12824657,-0.04926281, 0.22978055],
         [-0.16757338, 0.04031946,-0.29942959,-0.07586212],
         [-0.08738316,-0.25852029,-0.28760692,-0.09964241]],0.0),
       ([[-0.09144423, 0.31359564, 0.28093964,-0.23328495],
         [ 0.01160876,-0.01439129,-0.0625458 , 0.27234446],
         [ 0.00969943, 0.19579686, 0.24145396, 0.16612569],
         [-0.02250232,-0.2694769 ,-0.01865784,-0.18937491],
         [-0.18431827,-0.20394186,-0.0921858 , 0.26041554],
         [-0.04204506,-0.20346355, 0.15948141,-0.28430738],
         [-0.2639436 ,-0.29182545,-0.02195974, 0.06566701],
         [-0.20125409, 0.01203544, 0.1329126 , 0.26878119],
         [ 0.01842447, 0.29800402, 0.02988527,-0.31215603],
         [-0.0172175 , 0.01396973,-0.2199624 , 0.0975462 ]],0.0),
       ([[-0.23372797,-0.0289988 , 0.30507217,-0.23241849],
         [-0.27810403,-0.27330157,-0.25541967, 0.20196985],
         [ 0.08197035, 0.179384  ,-0.26744305, 0.29851794],
         [ 0.2421252 , 0.08249315, 0.27136965,-0.06443039],
         [-0.00700375, 0.11751228,-0.13813045, 0.11175486],
         [-0.0026995 , 0.18413436,-0.17782529, 0.15570792],
         [-0.02902272,-0.05802   , 0.26730321,-0.22090366],
         [-0.23338694,-0.07469927, 0.02655466, 0.28104436],
         [-0.11178097,-0.25460005, 0.28295255, 0.22580865],
         [-0.29976061,-0.24166525, 0.20831591,-0.22864893]],0.0),
       ([[ 0.0439374 ,-0.01405606,-0.12226221,-0.28042631],
         [ 0.27627884, 0.25551431, 0.14055402, 0.0974476 ],
         [-0.06817242, 0.29957824, 0.13345293,-0.0043966 ],
         [-0.10976804,-0.24295586, 0.2985574 ,-0.14266408],
         [-0.19767417,-0.18031615, 0.16497855, 0.28137271],
         [ 0.00098066, 0.10251067,-0.09651004,-0.23491296],
         [ 0.11466183,-0.06875847,-0.2996546 , 0.00037928],
         [ 0.01778915,-0.17502066,-0.31515912,-0.03379622],
         [ 0.00336834,-0.26498695, 0.20411864,-0.16431515],
         [-0.3100991 ,-0.17389888,-0.26298125, 0.20615811]],0.0),
       ([[ 0.13583072,-0.16155688,-0.2758538 ,-0.04632471],
         [ 0.1303121 , 0.13797244,-0.19388915, 0.15181975],
         [ 0.28886134, 0.01005223,-0.04424328,-0.30165804],
         [ 0.00463335, 0.11799231,-0.22883806, 0.10904979],
         [-0.29136501,-0.04314832, 0.22406372,-0.04912378],
         [-0.26028764,-0.28037069,-0.25091228,-0.00928717],
         [ 0.11046289,-0.25874082, 0.21010951, 0.17485089],
         [-0.27754466,-0.11231281,-0.07770368, 0.00143252],
         [-0.03164469,-0.02064208,-0.25000056,-0.079847  ],
         [-0.30245778,-0.03267406, 0.24862764, 0.17448261]],0.0),
       ([[-0.15864431, 0.14644161,-0.11691701,-0.00244731],
         [-0.28433566, 0.05219023,-0.13749962,-0.13070581],
         [-0.23650416, 0.24866945,-0.03081761, 0.09541946],
         [ 0.19562176,-0.13726634,-0.14332594,-0.07226615],
         [-0.04957938, 0.27332542, 0.23251141,-0.03467474],
         [-0.29776676,-0.24842964,-0.19210258,-0.16555387],
         [ 0.20523843, 0.2507595 ,-0.29859035, 0.04635983],
         [ 0.19330568,-0.05027235, 0.01598015,-0.1352553 ],
         [ 0.10033669,-0.25911677, 0.20381848, 0.19442587],
         [-0.19503874, 0.08747051, 0.21026909,-0.01908302]],0.0),
       ([[ 0.05081972,-0.2473516 ,-0.023768  , 0.24435035],
         [-0.02214684,-0.02136734,-0.19226353,-0.29173347],
         [ 0.07327741, 0.04087641,-0.24777659, 0.15282225],
         [-0.20018354,-0.09572778,-0.01234459, 0.09102707],
         [ 0.07692331, 0.16519296,-0.13493372,-0.00481602],
         [ 0.11505011, 0.00630549, 0.16963176,-0.1265313 ],
         [ 0.02964999,-0.16150073,-0.03567221, 0.19607036],
         [-0.25053656,-0.17077265, 0.18452801, 0.04208443],
         [ 0.20707684, 0.30037447, 0.29423379, 0.2844169 ],
         [ 0.03275292,-0.25770278, 0.15206177, 0.04066527]],0.0),
       ([[ 0.15549408,-0.02821391,-0.21777784, 0.31366812],
         [ 0.24646228, 0.19210799,-0.05598768,-0.18141553],
         [-0.1300077 , 0.07774861,-0.15924152, 0.18953487],
         [-0.30428559,-0.01242687, 0.14800427, 0.11609853],
         [-0.04978502, 0.12219252,-0.08399155,-0.16921891],
         [ 0.18028181, 0.14338093, 0.13057504,-0.29615267],
         [-0.16479341,-0.08155035, 0.05178466,-0.26057883],
         [-0.16941652, 0.19765246, 0.15984705, 0.19275784],
         [-0.13000542, 0.17747904,-0.17406042,-0.13291107],
         [ 0.22071552, 0.15442383,-0.10609241, 0.042586  ]],0.0),
       ([[ 0.12626878,-0.25808267,-0.28220025, 0.22945244],
         [ 0.08220049, 0.23378918,-0.26076719, 0.2314179 ],
         [-0.29014052, 0.28977474,-0.17242757, 0.15929158],
         [-0.06277205,-0.06130048,-0.15603502, 0.00432502],
         [-0.19950167,-0.28012466,-0.08416305, 0.13903731],
         [-0.01633346, 0.26728853,-0.20863298, 0.13811676],
         [ 0.23388056,-0.2344451 , 0.29981922, 0.16078008],
         [ 0.26352996,-0.2923824 ,-0.13544108, 0.20422487],
         [-0.14247096,-0.28351467,-0.22266022,-0.30579689],
         [ 0.17861596,-0.09542387, 0.15791013,-0.28147219]],0.0),
       ([[-0.26677087, 0.18299502,-0.08194217,-0.24604896],
         [-0.05994665, 0.09568975,-0.04029488,-0.18817124],
         [-0.03548735, 0.1531479 ,-0.25550249, 0.00741318],
         [ 0.21732212, 0.31214441, 0.08269747,-0.13567858],
         [-0.23652461,-0.30778088,-0.10235937,-0.00991679],
         [ 0.02921378,-0.29343446,-0.27750602,-0.30157962],
         [ 0.00467349,-0.1476208 ,-0.03459167, 0.2995368 ],
         [ 0.18833028,-0.13653101, 0.03528241,-0.19126215],
         [ 0.18379212,-0.26081224, 0.21372283,-0.16363993],
         [-0.04157616,-0.04562434,-0.25164319, 0.25855651]],0.0),
       ([[-0.22198474, 0.25776865,-0.30961634,-0.20647498],
         [ 0.21449012,-0.1200055 , 0.22071792, 0.26015676],
         [ 0.25291967, 0.23225578, 0.21361957,-0.15580994],
         [ 0.21693739, 0.07439454, 0.3062204 , 0.06991173],
         [ 0.09594247, 0.09769235, 0.0330947 ,-0.19876174],
         [ 0.30419617,-0.25555211, 0.15701523, 0.01557005],
         [-0.13233517,-0.17190726, 0.00236485, 0.2731937 ],
         [ 0.04688379, 0.30974169,-0.04441544,-0.05290127],
         [ 0.08087671, 0.25764235,-0.27232097, 0.03187775],
         [-0.21844645, 0.13822999,-0.23058892,-0.31335233]],0.0),
       ([[ 0.02372731,-0.30573356, 0.02246136,-0.28732956],
         [-0.21884266, 0.21693885, 0.18842711,-0.12421786],
         [-0.06419842,-0.03206922,-0.30324018, 0.07434775],
         [ 0.19261741,-0.16812438,-0.06316435,-0.0042285 ],
         [ 0.00118972,-0.1053113 ,-0.24955413, 0.0890547 ],
         [-0.22043028,-0.19278721,-0.27993022, 0.26230748],
         [ 0.20913413,-0.21566463, 0.23255812, 0.00461579],
         [-0.23508285,-0.24468582,-0.17531808, 0.24655455],
         [-0.0310396 , 0.12472635,-0.0693866 , 0.07755408],
         [ 0.13689381, 0.00054343, 0.16448981, 0.21035708]],0.0),
       ([[ 0.03791167, 0.02773479, 0.05563838,-0.30031882],
         [ 0.30933518,-0.27146622, 0.20087747,-0.22955874],
         [-0.21944965,-0.08902337,-0.15592404,-0.17786902],
         [ 0.04008723,-0.01260965,-0.25737976, 0.00879528],
         [-0.19136979,-0.01247813,-0.14102477,-0.30959726],
         [ 0.24525437,-0.07975361,-0.05298902, 0.23880414],
         [ 0.16492601, 0.03042894, 0.25446277, 0.26607488],
         [-0.02185716, 0.04151866,-0.29816608,-0.22747489],
         [-0.0632467 , 0.20687477,-0.02821297, 0.12243277],
         [ 0.08726643, 0.09858908, 0.17033229,-0.31608404]],0.0),
       ([[-0.12605127, 0.12362702,-0.25874551, 0.01495601],
         [ 0.24956381, 0.29327334, 0.13008863, 0.16698653],
         [-0.09827862,-0.15694363, 0.10575233,-0.22179898],
         [-0.0183939 ,-0.30212911, 0.16425569,-0.18615881],
         [ 0.21540833, 0.17383314,-0.20481184, 0.24321633],
         [-0.25736895,-0.18835257,-0.08069786,-0.20639825],
         [-0.09788278, 0.04284158,-0.21696261, 0.17439356],
         [-0.29493831,-0.30929699,-0.11376398, 0.01690371],
         [ 0.08204628, 0.24129053, 0.08926425,-0.30187867],
         [ 0.12344918, 0.24327516, 0.15899559,-0.14984265]],0.0),
       ([[ 0.00479053,-0.23768247, 0.06876417, 0.12226175],
         [-0.26703143,-0.06066419, 0.00852986, 0.19420577],
         [-0.25363598,-0.01737246, 0.04259072, 0.02275809],
         [-0.19968968, 0.05488643, 0.18082602, 0.31500631],
         [-0.28287864,-0.28923529, 0.01829978, 0.06538291],
         [-0.26420614, 0.13269908,-0.2427754 ,-0.19144272],
         [ 0.17663563,-0.02790462,-0.1208941 ,-0.08368919],
         [ 0.16653039,-0.20210276,-0.22911153, 0.00054447],
         [-0.30680258,-0.09657957,-0.10262399, 0.00292908],
         [-0.00481986,-0.09468136,-0.18822509,-0.21507023]],0.0),
       ([[ 0.03859024,-0.03404153, 0.22471083, 0.26005346],
         [ 0.23816049, 0.29436329,-0.18827486, 0.14317266],
         [ 0.04510547, 0.0530803 ,-0.02737148, 0.05193146],
         [-0.27337999,-0.31246433,-0.02023115, 0.18355614],
         [ 0.26749634, 0.13929289,-0.23658199, 0.13856624],
         [ 0.07304499,-0.07164557, 0.1803852 ,-0.25213215],
         [-0.06138748, 0.15330512,-0.30836393, 0.2708065 ],
         [-0.02515688,-0.27219304, 0.25926305,-0.23824315],
         [ 0.24968185,-0.18653642, 0.2732137 ,-0.00130973],
         [-0.08854121,-0.21448389, 0.14317274, 0.21204644]],0.0),
       ([[-0.11455104, 0.30235508,-0.01725896, 0.04183339],
         [-0.2234564 ,-0.25314386,-0.26150953, 0.16001999],
         [ 0.15323721,-0.11668402, 0.21839602, 0.02184922],
         [ 0.21033596,-0.19856954,-0.14169975, 0.05253024],
         [ 0.27192518,-0.27999097, 0.20130892,-0.21211106],
         [-0.03813321,-0.08441968,-0.27462561, 0.18202632],
         [ 0.0078349 ,-0.20438528, 0.01317482, 0.05755919],
         [-0.03507686,-0.22578156, 0.29172904,-0.05200696],
         [-0.23399265, 0.09549641, 0.05559626,-0.15511762],
         [-0.13443928, 0.1930753 ,-0.28067894,-0.14028389]],0.0),
       ([[ 0.27620054, 0.21402711, 0.25815181, 0.0598411 ],
         [ 0.17297742,-0.09859982,-0.07344879,-0.07719674],
         [-0.04682438, 0.13085369,-0.1618007 ,-0.20378896],
         [-0.17932299, 0.14191695, 0.08315969, 0.18628023],
         [ 0.18070425,-0.22453606,-0.2608954 ,-0.15384043],
         [ 0.08861803, 0.04408714, 0.24624226, 0.26445614],
         [-0.21985107,-0.24097504,-0.30986928,-0.13924173],
         [-0.238485  ,-0.0267933 ,-0.1970722 ,-0.31141385],
         [ 0.25066615, 0.31468011, 0.19353396,-0.29714789],
         [ 0.02234053, 0.06957043, 0.22225983,-0.05694756]],0.0),
       ([[-0.15090577, 0.16114397, 0.18409262, 0.18169796],
         [ 0.28320212,-0.06311385, 0.10006483, 0.01621376],
         [-0.05177097,-0.0584798 ,-0.08141669, 0.2174979 ],
         [-0.01845121, 0.05369522,-0.21141849, 0.02982549],
         [ 0.02455099, 0.00482561, 0.0904923 , 0.02826048],
         [-0.11494598, 0.18226821, 0.04074616,-0.05339262],
         [-0.1088262 , 0.26604124, 0.27225267,-0.30946571],
         [-0.25735736,-0.23142216, 0.08053501,-0.15071939],
         [ 0.05220475, 0.03472307,-0.1895212 , 0.09934619],
         [ 0.28030865,-0.09058807,-0.29611488,-0.01674297]],0.0),
       ([[-0.27356384,-0.0004719 , 0.12152237,-0.26808676],
         [-0.17087049,-0.00166471, 0.02706323,-0.00320345],
         [ 0.19054808,-0.12145723,-0.24411533, 0.03812508],
         [ 0.17019938,-0.04099139,-0.2633963 , 0.06235624],
         [ 0.21887018,-0.2003267 , 0.26118465,-0.25067232],
         [-0.23601734,-0.31365088, 0.17998991, 0.03824993],
         [ 0.10152185, 0.01380161, 0.18704629,-0.15707403],
         [ 0.0192782 ,-0.28061783,-0.22937106,-0.22642663],
         [ 0.10357595,-0.24802406, 0.16256293,-0.02893172],
         [ 0.12277711,-0.09061356, 0.16950929, 0.20069569]],0.0)]

layers :: [Layer]
layers = [
    ConvLayer 3 fc1
  , ActLayer relu
  , MaxPoolLayer 2
  , ConvLayer 2 fc2
  , ActLayer relu
  ]

main :: IO ()
main = do
    putStrLn ("X=\n" ++ (show x))
    putStrLn ("FC1=\n" ++ (show fc1))
    let
      rls = tail $ map reverseLayer $ reverse layers
      im  = fst $ head x
      op  = forwardProp layers [im]
    putStrLn ("OPLEN=\n" ++ (show $ length op))
    putStrLn ("OP=\n" ++ (show $ head op))
